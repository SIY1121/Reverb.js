<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Reverb.js - Demo</title>
    <script type="text/javascript" src="https://raw.githubusercontent.com/burnson/Reverb.js/master/reverb.js"></script>
  </head>
  <body>
    <div>Reverb.js</div>
<script type="text/javascript">
var reverb, masterGain, context;

function dBToGain(dB) {
  return (dB <= -100) ? 0 : Math.pow(10, dB / 10);
}

function initialize () {
  context = new (window.AudioContext || window.webkitAudioContext)();
  reverbjs.extend(context);
  masterGain = context.createGain();
  masterGain.gain.value = 1;
  masterGain.connect(context.destination);
}

function midiNoteNumberToFrequency (midiNoteNumber) {
  return 55 * Math.pow(2, (midiNoteNumber - 33) / 12);
}

function playScale () {
  var i, loudness = 0.1;
  var notesGoingUp = [60, 62, 64, 65, 67, 69, 71, 72]
  var notesGoingDown = [48, 47, 45, 43, 41, 40, 38, 36];
  var s = context.currentTime;
  for (i = 0; i < notesGoingUp.length; i++) {
    scheduleSynthNote(notesGoingUp[i], s + 1 + i * 0.5, 0.25, loudness);
    scheduleSynthNote(notesGoingDown[i], s + 1 + i * 0.5, 0.25, loudness);
  }
}

function scheduleOscillator(type, note, startTime, duration, gain, shape) {
  var gainShaper = context.createGain();
  gainShaper.gain.value = 0;
  gainShaper.gain.setValueAtTime(0, startTime);
  for (var i in shape) {
    var g = dBToGain(shape[i].dB) * gain;
    var t = startTime + shape[i].time * duration;
    gainShaper.gain.linearRampToValueAtTime(g, t);
  }
  gainShaper.connect(reverb);
  
  var oscillator = context.createOscillator();
  oscillator.type = type;
  oscillator.frequency.value = midiNoteNumberToFrequency(note);
  oscillator.start(startTime);
  oscillator.stop(startTime + duration);
  oscillator.connect(gainShaper);
}

function scheduleSynthNote (note, start, duration, gain) {
  gain /= dBToGain(-55);
  scheduleOscillator('triangle', note, start, duration, gain,
    [{time:0.05, dB:-65},{time:0.95, dB:-65},{time:1.0, dB:-100}]);
  scheduleOscillator('sawtooth', note + 12, start, duration, gain,
    [{time:0.05, dB:-55},{time:0.95, dB:-60},{time:1.0, dB:-100}]);
  scheduleOscillator('sine', note + 24, start, duration, gain,
    [{time:0.2, dB:-58},{time:0.95, dB:-58},{time:1.0, dB:-100}]);
  scheduleOscillator('square', note + 48, start, duration, gain,
    [{time:0.2, dB:-75},{time:0.95, dB:-75},{time:1.0, dB:-100}]);
}

function shutdownGracefully () {
  var start = context.currentTime, length = 0.5, progress = 0;
  while (progress <= 1) {
    masterGain.gain.value = 1 - progress;
    progress = (context.currentTime - start) / length;
  }
}

function testReverb (url) {
  reverb = context.createReverbFromUrl(url, function() { playScale(); });
  reverb.connect(masterGain);
}

window.onload = initialize;
window.onbeforeunload = shutdownGracefully;
        </script>
        <a href="#" onclick="testReverb('https://github.com/burnson/Reverb.js/raw/master/Library/StMarysAbbeyReconstructionPhase1.m4a');">Try StMarysAbbeyReconstructionPhase1.m4a</a>
    </body>
</html>